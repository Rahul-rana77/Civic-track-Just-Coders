<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Issue Details</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }

    .container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    img {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    h2 {
      margin-bottom: 10px;
    }

    p {
      margin-bottom: 8px;
      font-size: 16px;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      background-color: #eee;
      font-weight: bold;
    }

    .status.reported {
      background-color: #ff6666;
      color: white;
    }

    .status.in-progress {
      background-color: #ffcc00;
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="issueImage" src="" alt="Issue Image" />
    <h2 id="issueTitle">Loading...</h2>
    <p>Status: <span id="issueStatus" class="status"></span></p>
    <p><strong>Category:</strong> <span id="issueCategory"></span></p>
    <p><strong>Date:</strong> <span id="issueDate"></span></p>
    <p><strong>Location:</strong> <span id="issueLocation"></span></p>
    <p><strong>Description:</strong></p>
    <p id="issueDescription"></p>
  </div>

  <script>
    async function loadIssue() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) return;

      try {
        const res = await fetch("http://localhost:8000/api/issues");
        const issues = await res.json();
        const issue = issues.find(i => i.id == id);

        if (!issue) {
          document.querySelector('.container').innerHTML = "<p>Issue not found.</p>";
          return;
        }

        document.getElementById("issueTitle").textContent = issue.title;
        document.getElementById("issueStatus").textContent = issue.status || 'Reported';
        document.getElementById("issueStatus").classList.add(issue.status?.toLowerCase().replace(" ", "-"));
        document.getElementById("issueCategory").textContent = issue.category;
        document.getElementById("issueDate").textContent = new Date(issue.date || Date.now()).toLocaleDateString();
        document.getElementById("issueLocation").textContent = issue.location;
        document.getElementById("issueDescription").textContent = issue.description || "No description provided";

        let imageUrl = issue.image?.startsWith("/uploads")
          ? `http://localhost:8000${issue.image}`
          : issue.image || "https://via.placeholder.com/600x300?text=No+Image";

        document.getElementById("issueImage").src = imageUrl;

      } catch (err) {
        console.error("Error fetching issue:", err);
      }
    }

    window.onload = loadIssue;
  </script>
</body>
</html>
